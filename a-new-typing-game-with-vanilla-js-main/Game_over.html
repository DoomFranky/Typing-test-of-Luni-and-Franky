<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Test</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
	<link rel="stylesheet" href="index.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/js/all.min.js" 
	integrity="sha512-1JkMy1LR9bTo3psH+H4SV5bO2dFylgOy+UJhMus1zF4VEFuZVu5lsi4I6iIndE4N9p01z1554ZDcvMSjMaqCBQ==" 
	crossorigin="anonymous" referrerpolicy="no-referrer"
	defer>
	</script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<style>
		main {
		margin-top: 100px; 
		text-align: center;
		}

		h1 {
			margin-top: 30px;
		}
	</style>
</head>

<body>
	<nav class="col-lg-fluid">

		<div class="logo">
			<a href="index.html"><img src="assets/img/T leaf.jpg" alt="T_leaf_type"></a>
		</div>
		<div class="title"><p> Leaf Types</p></div>

		<div class="menue">
			<div class="btn"><i class="fa-solid fa-bars fa-2x"></i></div>
			<div class="dropDown">
				<ul>
					<li><a href="help.html"><i class="fa-solid fa-question"></i>: help</a></li>
					<li><a href="Loging.html"><i class="fa-solid fa-right-from-bracket"></i>: exit</a></li>
					<li><a href="index.html"><i class="fa-solid fa-play"></i>: play</a></li>
					<li><a href="Game_over.html"><i class="fa-solid fa-chart-simple"></i> stat</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<main>
		<h1>Résultat du Test</h1>
		<p id="summary">Chargement...</p>

		<section>
			<h4>Historique des tests</h4>
			<canvas id="historyChart" width="800" height="400"></canvas>
		</section>

		<div class="buttons mt-4">
			<a href="index.html" class="btn btn-success">Rejouer</a>
			<button class="btn btn-danger" onclick="resetHistory()">Réinitialiser l'historique</button>
		</div>
	</main>
	<footer>
	</footer>

    <script>
		const results = JSON.parse(localStorage.getItem("typingResults"));
		const historyData = JSON.parse(localStorage.getItem("testHistory"));

		if (results) {
			document.getElementById("summary").innerHTML = `
				<strong>WPM Moyen :</strong> ${results.avgWPM}<br>
				<strong>Précision :</strong> ${results.accuracy}%
			`;
		}

		if (historyData && historyData.length > 0) {
			const labels = historyData.map((_, i) => `Test ${i + 1}`);
			const wpmData = historyData.map(entry => parseFloat(entry.avgWPM));
			const emojis = wpmData.map(wpm => {
				if (wpm >= 60) return " (°o°)";
				else if (wpm >= 30) return " (*~*)";
				else return " (T-T)";
			});

			const ctx = document.getElementById("historyChart").getContext("2d");
			new Chart(ctx, {
				type: 'line',
				data: {
					labels: labels.map((label, i) => label + emojis[i]),
					datasets: [{
						label: 'WPM moyen',
						data: wpmData,
						borderColor: 'rgb(245, 163, 57)',
						backgroundColor: 'rgba(245, 163, 57, 0.2)',
						fill: true,
						tension: 0.3,
						pointRadius: 4,
						pointBackgroundColor: 'white'
					}]
				},
				options: {
					responsive: true,
					scales: {
						x: {
							ticks: { color: 'white' },
							grid: { color: 'rgba(255,255,255,0.1)' }
						},
						y: {
							beginAtZero: true,
							ticks: { color: 'white' },
							grid: { color: 'rgba(255,255,255,0.1)' }
						}
					},
					plugins: {
						legend: {
							labels: { color: 'white' }
						},
						tooltip: {
							callbacks: {
								label: context => `WPM: ${context.raw}`
							},
							backgroundColor: 'rgba(0,0,0,0.7)',
							titleColor: 'rgb(245, 163, 57)',
							bodyColor: 'white'
						}
					}
				}
			});
		}

		function resetHistory() {
			localStorage.removeItem("testHistory");
			location.reload();
		}
	</script>
</body>

</html>